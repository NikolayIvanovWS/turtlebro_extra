# Пакет патрулирования turtlebro_patrol для робота TurtleBro


## Установка пакета

Пакет входит в сборку метапакета `turtlebro_extra` и устанавливается автоматически при установке этого пакета. В случае, если вы хотите установить пакет патрулирования отдельно, на роботе выполните команды:

```
cd ~/catkin_ws/src
git clone https://github.com/voltbro/turtlebro_patrol
cd ..
catkin_make --pkg turtlebro_patrol
```

## Запуск пакета патрулирования

Перед запуском вы должны очистить данные одометрии из STM32, отправив команду сброса:

```
rosservice call /reset
```

__Запуск нод патрулирования и навигации__

```
roslaunch turtlebro_patrol patrol.launch
```

__Запуск ноды патрулирования__

```
roslaunch turtlebro_patrol patrol_run.launch
```

## Настройка патрулирования

Координаты точек патрулирования задаются в файле:

```
~/catkin_ws/src/turtlebro_extra/turtlebro_patrol/data/goals.xml
```

_Важное примечание!_ 

когда вы добавляете в goals.xml точки, вида:

```
<goal x='1' y='0' theta='90' name="point_name"/>
```

помните, что **ось x** направлена вперед для робота, а **ось y** - влево для робота. 
**"Theta"** должна быть установлена в градусах и направлена по правилу правой руки:


![Направление осей](https://user-images.githubusercontent.com/57194638/201637592-358a0765-1cf6-474c-a713-78d55bb93c07.jpg)


## Управление патрулированием

Управление роботом при патрулировании осуществляется путем отправки сообщений типа: ** std_msgs/String ** в топик **/patrol_control**. Пример:

```
rostopic pub /patrol_control std_msgs/String "data: 'start'" 
```

Допустимые команды:
1. **start** - запускает цикл патрулирования или переключает робота на следующую цель
2. **pause** - приостанавливает патрулирование в любой точке
3. **resume** - возобновляет патрулирование в любой точке
4. **home** - отправляет в стартовую позицию
5. **shutdown** - останавливает патрулирование и выключает пакет


## Callback_service

Если вам нужно выполнить какое-либо действие в точке патрулирования, вы должны указать ```point_callback_service``` из ```.launch``` файла

Нода патрулирования выполнит запрос на обслуживание с ```PatrolPointCallback``` тип сообщения о достижении точки.

__Запуск из терминала с callback_servicee__ 
```
python3 patrol.py _point_callback_service:=my_service_name
```
