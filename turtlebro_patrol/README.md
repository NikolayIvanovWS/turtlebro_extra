# Пакет патрулирования turtlebro_patrol для робота TurtleBro


## Установка пакета

Пакет входит в сборку метапакета `turtlebro_extra` и устанавливается автоматически при установке этого пакета. В случае, если вы хотите установить пакет патрулирования отдельно, на роботе выполните команды:

```
cd ~/catkin_ws/src
git clone https://github.com/voltbro/turtlebro_patrol
cd ..
catkin_make --pkg turtlebro_patrol
```

## Запуск пакета патрулирования

Перед запуском вы должны очистить данные одометрии из STM32, отправив команду сброса:

```
rosservice call /reset
```

__Запуск нод патрулирования и навигации__

```
roslaunch turtlebro_patrol patrol.launch
```

__Запуск ноды патрулирования__

```
roslaunch turtlebro_patrol patrol_run.launch
```

## Настройка патрулирования

Координаты точек патрулирования задаются в файле:

```
~/catkin_ws/src/turtlebro_extra/turtlebro_patrol/data/goals.toml
```

_Важное примечание!_ 

когда вы добавляете в goals.toml точки, вида:

```
[[patrolling]]
name = "PointName"
pose = {x = 0, y = 0, theta = 0}
```

помните, что **ось x** направлена вперед для робота, а **ось y** - влево для робота. 
**"theta"** должна быть установлена в градусах и направлена по правилу правой руки:


![Направление осей](https://user-images.githubusercontent.com/57194638/201637592-358a0765-1cf6-474c-a713-78d55bb93c07.jpg)

В качестве имя точки **name = "PointName"** вы можете указывать реальный объект/место, к которому ведется патрулирование. Пример:

```
[[patrolling]]
name = "Room1"
pose = {x = 0.5, y = 0, theta = 90}

[[patrolling]]
name = "Da Vinci Painting"
pose = {x = 0, y = -1.3, theta = -45}
```


## Управление патрулированием

Управление роботом при патрулировании осуществляется путем отправки сообщения типа: ** std_msgs/String ** в сервис **/patrol_control**. Пример:

```
rosservice call /patrol_control "command: 'start'" 
```

Допустимые команды:
1. **start** - запускает цикл патрулирования или переключает робота на следующую цель
2. **pause** - приостанавливает патрулирование в любой точке
3. **resume** - возобновляет патрулирование в любой точке
4. **home** - отправляет в стартовую позицию
5. **shutdown** - останавливает патрулирование и выключает пакет


## Callback_service

Если вам нужно выполнить какое-либо действие в точке патрулирования, вы должны указать ```point_callback_service``` из ```.launch``` файла

Нода патрулирования выполнит запрос на обслуживание с ```PatrolPointCallback``` тип сообщения о достижении точки.

__Запуск из терминала с callback_service__ 
```
python3 patrol.py _point_callback_service:=my_service_name
```
