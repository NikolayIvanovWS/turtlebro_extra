## Инструкция пакета turtlebro_delivery

Пакет предназначен для работы робота Turtlebro с расширением "Робот-курьер".

### Установка пакета ROS

Пакет `turtlebro_delivery` устанавливается при установке метапакета `turtlebro_extra` https://github.com/voltbro/turtlebro_extra

__Установка метапакета__ 
```
cd ~/catkin_ws/src
git clone https://github.com/voltbro/turtlebro_extra
cd ../
catkin_make
```

### Установка зависимостей ROS

Для работы пакета необходимо установка `python` зависимостей

```
cd ~/catkin_ws/src
pip3 install -r turtlebro_extra/turtlebro_delivery/requirements.txt
```

### Подключение полезной нагрузки

Для управления полезной нагрузкой робота-курьера, необходимо загрузить на робота Ардуино скетч, который находится в папке: `arduino/delivery/delivery.ino`

Сервопривод подулючить в разъем `D46`

Концевой выключатель в `A12`

Кнопка управления крышкой в `A15`

### Алгоритм работы робота-курьера

Пакет доставки работает по следующему алгоритму:

1. Прежде чем положить товар в грузовой отсек, необходимо отсканировать товар (aruco-маркер) камерой робота. Это определит в какую точку необходимо доставить товар

2. Поместить товар в грузовой отсек робота и нажать на кнопку для закрытия крышки

3. Робот отправится в заданные координаты

4. В точке завершения маршрута необходимо в камеру продемонстрировать aruco-маркер клиента для открытия крышки грузового отсека

5. Если aruco-маркер клиента соответствует заказанному товару, робот откроет грузовой отсек

6. Необходимо забрать товар и нажать кнопку для завершения доставки

7. Робот вернется в место загрузки и будет ждать следующего заказа

Конфигурирование параметров робота-курьера происходит в файле `data/delivery.toml`


### Запуск доставки

Запуск функционирования в режиме курьера: 

```
roslaunch turtlebro_delivery delivery.launch
```

Для отладки кода есть возможность эмулировать работу без подключения навигации и реального перемещения роботы. Для этого необходимо установить агрумент  `fake_move_base`

```
roslaunch turtlebro_delivery delivery.launch fake_move_base:=true
```

### Подключение работы колонки для озвучки статусов доставки

Для подключения колонки к роботу, необходимо убедиться что правильно установлен пакет `turtlebro_speech` (https://github.com/voltbro/turtlebro_extra/tree/master/turtlebro_speech) из метапакета `turtlebro_extra`

Запуск доставки с озвучкой статусов

```
roslaunch turtlebro_delivery delivery_speech.launch
или 
roslaunch turtlebro_delivery delivery_speech.launch fake_move_base:=true
```

Конфигурация фраз находится в файле `data/speech.toml`

